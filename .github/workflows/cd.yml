name: Build & Push Docker image

on:
    push:
        branches: ["main"] # build on every push/merge to main
    workflow_dispatch: # manual trigger in the UI

jobs:
    build-and-push:
        runs-on: ubuntu-latest

        steps:
            # Get source
            - uses: actions/checkout@v4

            # Enable Buildx (new Docker builder)
            - uses: docker/setup-buildx-action@v3

            # Login to Docker Hub
            - name: Login to Docker Hub
              uses: docker/login-action@v3
              with:
                  username: ${{ secrets.DOCKERHUB_USERNAME }}
                  password: ${{ secrets.DOCKERHUB_TOKEN }}

            # Build and push
            - name: Build & Push
              uses: docker/build-push-action@v5
              with:
                  context: .
                  push: true
                  # Two tags: :latest and :<git-SHA>
                  tags: ${{ secrets.DOCKERHUB_USERNAME }}/2025cloud:latest,${{ secrets.DOCKERHUB_USERNAME }}/2025cloud:${{ github.sha }}
